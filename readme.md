# AI 创意助手

> 🧠 **项目大脑 & RAG 知识库**: 本文档为项目高级概述。有关最详尽的技术深度剖析、架构决策、设计哲学演进以及可作为 RAG (Retrieval-Augmented Generation) 系统使用的核心知识库，请**务必参阅** **[PROJECT_BRAIN.md](./PROJECT_BRAIN.md)**。

## 1. 项目摘要

AI 创意助手是一款先进的、对话式的 Web 应用程序，旨在帮助用户完成各种创意任务。它利用 Google Gemini 模型的强大功能来理解自然语言请求，并执行复杂的工作流，包括海报设计、长图文生成、图像处理等。

该应用程序以丰富的交互式聊天界面作为主要交互方式，并由功能强大、专业的编辑器支持，用于微调 AI 生成的结果。它的构建重点是稳健性、可扩展性和高质量的用户体验。

## 2. 核心功能

-   **对话式界面**: 用户通过自然的聊天对话与助手互动。
-   **多模态能力**: 助手可以处理文本和图像。
-   **海报与长图文设计**:
    -   通过简单的文本提示生成创意内容。
    -   **动态模板生成**: 当没有匹配的预设模板时，系统采用先进的两步 AI 工作流动态创建布局。
    -   **完整的预览与导出**: AI 生成的结果会以“所见即所得”的方式完整呈现在聊天窗口中，并提供“直接导出”按钮。
-   **专业级编辑器**: 
    -   提供行业标准的三栏式布局（图层/工具、画布、检查器）。
    -   **高级布局引擎**: 支持**约束布局**、**中心点约束**、**锚点定位 (Anchor)** 以及 **Flexbox/Grid 双模内容布局**，以实现专业级的响应式设计。
    -   **设计师友好的控件**: 提供清晰的、基于文本的**智能对齐按钮**和**可视化 Grid 构建器**，简化了复杂的布局操作。
    -   **高级文本效果**: 包括与布局引擎无缝集成的艺术性**文字弯曲**，允许进行创意排版而不会破坏设计结构。
-   **高级图像工具**:
    -   图像生成、图像超分辨率、背景移除。
-   **可扩展性与定制化**:
    -   **自定义功能管理器**: 用户可以通过提供系统提示来定义自己的 AI 工具。
    -   **模板管理器**: 用户可以创建、编辑、导入和导出自己的设计模板。
    -   **AI 赋能的导入**: 使用 AI 将一张完成的海报图片瞬间转换为一个完全可编辑的、结构化的模板。
-   **数据持久化**: 所有用户创建的工具和模板都使用 IndexedDB 本地保存在浏览器中。

## 3. 技术架构

该应用程序被架构为一个现代化的单页应用，具有清晰的关注点分离，强调模块化和可测试性。

### 3.1. 前端技术栈

-   **框架**: React 19
-   **语言**: TypeScript
-   **样式**: Tailwind CSS
-   **本地存储**: `idb` 库 (IndexedDB 的封装)
-   **AI SDK**: `@google/genai`
-   **构建/导入**: `importmap`

### 3.2. 核心原则与设计模式

-   **专家 Agent 模式**: 所有与 AI 的交互都被拆分到多个职责单一的服务中（例如 `chatRouterService.ts`, `posterAgentService.ts`），将 UI 与 AI 逻辑解耦。
-   **专业级布局系统**: 采用固定画布和强大的约束/网格布局引擎，确保布局的专业性、可预测性和响应能力。
-   **模板与实例解耦**: 严格区分“模板编辑器”（用于设计可复用的“蓝图”）和“实例编辑器”（用于填充“内容”）。这种分离确保了最终用户无法意外破坏核心布局，同时为模板设计师提供了最大的灵活性，从而提高了应用的稳定性和可维护性。
-   **单一真相来源 (Single Source of Truth) 渲染**: 为了从根本上解决“所见即所得”(WYSIWYG) 的问题，预览图的生成被重构为一种“编辑器级离屏快照”架构。系统现在使用与编辑器**完全相同**的渲染组件，在内存中确定性地（等待所有图片加载完成）生成快照。这确保了从预览、编辑到最终导出的所有环节，都达到 100% 的像素级视觉一致性。
-   **类型即真相 (Types as Truth) 与 AI Schema 自动化**: 为了从根本上解决前端功能与 AI 提示词不同步的“功能-提示词漂移”问题，我们建立了一套**自动化的“类型到 Schema”生成管线**。该系统在每次构建时，都会自动读取核心的 `types.ts` 文件，并将其中的 TypeScript 类型编译成 AI 模型所需的 JSON Schema。这确保了 `types.ts` 成为定义 AI 数据契约的**唯一真相来源**，从而杜绝了因人为疏忽导致的数据结构不一致问题。
-   **稳健的状态管理与交互**: 为了处理如 `contentEditable` 等复杂的浏览器特性和提供专业级的用户体验，应用采用了先进的 React 模式（如使用 `key` 属性强制组件重渲染、自定义 Hook 抽象化输入逻辑）和严谨的事件处理逻辑。这从根本上避免了常见的渲染 Bug 和状态竞争问题，确保了数据在状态转换过程中的完整性，提供了稳定且可预测的编辑体验。

> 欲了解关于“专家 Agent 工作流”和“布局引擎”的完整深度剖析，请参阅 **[PROJECT_BRAIN.md](./PROJECT_BRAIN.md)**。

### 3.3. 文件结构

```
/
├── components/
├── hooks/
├── services/
├── scripts/                    # 新增: 构建脚本, 如 schema 生成器
├── App.tsx                     # 主应用组件, 状态管理和 Agent 编排
├── constants.ts                # 应用范围的常量
├── index.html                  # 主 HTML 入口点
├── index.tsx                   # React 根渲染器
├── readme.md                   # 本文件 (高级概述)
├── PROJECT_BRAIN.md            # 项目大脑 (深度技术细节)
└── types.ts                    # 集中式 TypeScript 类型定义
```

## 4. 如何扩展应用

该应用程序为轻松扩展而设计。

> 完整的扩展指南和最佳实践，请参阅 **[PROJECT_BRAIN.md](./PROJECT_BRAIN.md)** 中的扩展指南。